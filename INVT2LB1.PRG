* PROGRAM:  INVT2LB1.PRG
* WRITTEN BY AMJAD IZHAR
* THIS REVISION : SATURDAY 14TH MAY.2005
********************************************

******************
PROCEDURE REINDEX
******************

CLEAR
CLOSE ALL

SET SAFETY OFF
SET DELETED OFF
SET EXCLUSIVE OFF

IF _DOS
 SET COLOR TO 7/1
ENDIF

CLEAR
@ 2, 2 SAY 'Reindex/Re-organize Data Files'

P= ' '

DO WHILE .not. P$'CQ'
   @ 3, 2 SAY 'Continue/Quit  -  C/Q  ' GET P FUNCTION '!'
   READ
ENDDO

IF P='Q'
   CLOSE ALL
   CLEAR
   RETURN
ENDIF

CLEAR

@ 2, 20 SAY 'Re-indexing Data Files  --- Please wait'
CLOSE ALL

SET EXCLUSIVE ON

CLOSE ALL
USE item
PACK
USE ldgrcode
PACK
USE item-bal
PACK
USE stock
PACK
USE loc
PACK
USE dept
PACK
USE mach
PACK
USE zone
PACK
USE city
PACK
USE st-tran
PACK
USE st-work
ZAP
USE st-cor
ZAP
USE st-key
PACK
USE p-order
PACK
USE s-order
PACK
USE formula
PACK
COPY TO for-work STRUCTURE
USE for-work
ZAP
CLOSE ALL
SET EXCLUSIVE OFF
CLOSE ALL
USE item
INDEX ON STR(I1,2)+STR(I2,2)+STR(I3,4) TO item-idx
INDEX ON ITEM TO itm1-idx
USE ldgrcode
INDEX ON STR(C1,2)+STR(C2,2)+STR(C3,3) TO ac1
USE item-bal
INDEX ON STR(LOC_CODE,4)+STR(I1,2)+STR(I2,2)+STR(I3,4) TO itm-bal
INDEX ON STR(I1,2)+STR(I2,2)+STR(I3,4) TO itmd-idx
USE stock
INDEX ON STR(D_D1,2)+STR(D_D2,2)+STR(D_D3,3) TO std-idx
INDEX ON STR(CITY_CODE,3)+STR(I1,2)+STR(I2,2)+STR(I3,4) TO cstck
INDEX ON STR(ZONE_CODE,2)+STR(I1,2)+STR(I2,2)+STR(I3,4) TO zstck
INDEX ON STR(LOC_CODE,4)+STR(I1,2)+STR(I2,2)+STR(I3,4) TO stck-idx
INDEX ON STR(I1,2)+STR(I2,2)+STR(I3,4) TO itemidx
INDEX ON DTOC(DATE)+STR(DOC_NO,7) TO itemidx1
INDEX ON DOC_NO TO itemidx2
INDEX ON DATE TO stk-idx
USE loc
INDEX ON LOC_CODE TO loc-idx
USE dept
INDEX ON DEPT_CODE TO dept-idx
USE mach
INDEX ON STR(DEPT_CODE,3)+STR(MACH_CODE,4) TO mach-idx
USE zone
INDEX ON ZONE_CODE TO zone-idx
USE city
INDEX ON CITY_CODE TO city-idx
USE st-tran
INDEX ON STR(DOC_NO,7)+STR(DOC_TYPE,1) TO stidx
INDEX ON STR(DOC_NO,7)+STR(DOC_TYPE,1)+STR(VCH_TYPE,1)+STR(VCH_NO1,2)+STR(VCH_NO2,5) TO stidx1
USE st-key
INDEX ON STR(DOC_NO,7)+STR(DOC_TYPE,1) TO st-idx
USE p-order
INDEX ON STR(ORDER_NO,5)+STR(C1,2)+STR(C2,2)+STR(C3,3)+STR(I1,2)+STR(I2,2)+STR(I3,4) TO pord-idx
USE s-order
INDEX ON STR(ORDER_NO,5)+STR(C1,2)+STR(C2,2)+STR(C3,3)+STR(I1,2)+STR(I2,2)+STR(I3,4) TO sord-idx
USE formula
INDEX ON STR(FI1,2)+STR(FI2,2)+STR(FI3,4)+STR(RI1,2)+STR(RI2,2)+STR(RI3,4) TO for-idx
INDEX ON STR(FI1,2)+STR(FI2,2)+STR(FI3,4) TO for-idx1
CLEAR
CLOSE ALL
SET EXCLUSIVE OFF
SET DELETED ON
CLOSE ALL
RETURN
*************

****************
PROCEDURE DSORT
****************
CLEAR
CLOSE ALL
SET EXCLUSIVE ON
CLOSE ALL
SELECT 1
USE st-tran
INDEX ON STR(DOC_NO,7)+STR(DOC_TYPE,1) TO stidx
SELECT 2
USE st-key
INDEX ON STR(DOC_NO,7)+STR(DOC_TYPE,1) TO st-idx
ZAP
SELECT 1
DO WHILE .not. EOF()
   MDOC_TYPE= DOC_TYPE
   MDOC_NO= DOC_NO
   SELECT 2
   SEEK STR(MDOC_NO,7)+STR(MDOC_TYPE,1)
   IF .not. FOUND()
      APPEND BLANK
      REPLACE DOC_TYPE WITH MDOC_TYPE
      REPLACE DOC_NO WITH MDOC_NO
   ENDIF
   SELECT 1
   SKIP
ENDDO
SELECT 2
GOTO TOP
REPLACE ALL FLAG WITH 'Y'
CLOSE ALL
CLEAR
USE st-key
INDEX ON STR(DOC_NO,7)+STR(DOC_TYPE,1) TO st-idx
SET EXCLUSIVE OFF
SET DELETED ON
CLOSE ALL
RETURN
**********

